# Виджеты (2)

## GtkTextView, GtkTextBuffer и GtkScrolledWindow

### GtkTextView и GtkTextBuffer

GtkTextView — это виджет для многострочного редактирования текста.
GtkTextBuffer — это текстовый буфер, который подключен к GtkTextView.
Посмотрите пример программы `tfv1.c` ниже.

@@@include
tfv/tfv1.c
@@@

Посмотрите на строку 25.
Создается экземпляр GtkTextView, и его указатель присваивается `tv`.
Когда создается экземпляр GtkTextView, экземпляр GtkTextBuffer также создается и подключается к GtkTextView автоматически.
"Экземпляр GtkTextBuffer" будет упоминаться просто как "GtkTextBuffer" или "буфер".
В следующей строке указатель на буфер присваивается `tb`.
Затем текст со строки 10 по 20 присваивается буферу.
Если третий аргумент `gtk_text_buffer_set_text` является положительным целым числом, это длина текста.
Если это -1, строка заканчивается NULL.

GtkTextView имеет режим переноса.
Когда он установлен в `GTK_WRAP_WORD_CHAR`, текст переносится между словами, или, если этого недостаточно, также между графемами.

Режим переноса описан в [Gtk\_WrapMode](https://docs.gtk.org/gtk4/enum.WrapMode.html) в документации GTK 4 API.

В строке 30 `tv` добавляется в `win` как дочерний элемент.

Теперь скомпилируйте и запустите программу.
Если вы загрузили этот репозиторий, его путь — `src/tfv/tfv1.c`.

```
$ cd src/tfv
$ comp tfv1
$ ./a.out
```

![GtkTextView](../image/screenshot_tfv1.png){width=6.3cm height=5.325cm}

В окне есть I-образный указатель.
Вы можете добавлять или удалять любые символы в GtkTextView, и ваши изменения сохраняются в GtkTextBuffer.
Если вы добавите больше символов за пределы окна, высота увеличится, и окно расширится.
Если высота станет больше высоты экрана,
вы не сможете контролировать размер окна или вернуть его к исходному размеру.
Это проблема, то есть ошибка.
Это можно решить, добавив GtkScrolledWindow между GtkApplicationWindow и GtkTextView.

### GtkScrolledWindow

Что нам нужно сделать:

- Создать GtkScrolledWindow и вставить его как дочерний элемент GtkApplicationWindow
- Вставить виджет GtkTextView в GtkScrolledWindow как дочерний элемент.

Модифицируйте `tfv1.c` и сохраните его как `tfv2.c`.
Между этими двумя файлами есть лишь несколько различий.

@@@shell
cd tfv; diff tfv1.c tfv2.c
@@@

Полный код `tfv2.c` следующий.

@@@include
tfv/tfv2.c
@@@

Скомпилируйте и запустите программу.

Теперь окно не расширяется, даже если вы введете много символов,
оно просто прокручивается.
