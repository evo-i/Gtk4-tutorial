# Виджеты (1)

## GtkLabel, GtkButton и GtkBox

### GtkLabel

Мы создали окно и показали его на экране в предыдущем разделе.
Теперь перейдем к следующей теме: виджеты.
Самый простой виджет — это GtkLabel.
Это виджет с текстом внутри.

@@@include
misc/lb1.c
@@@

Сохраните эту программу в файл `lb1.c`.
(Вы можете использовать `src/misc/lb1.c`, если загрузили этот репозиторий.)
Затем скомпилируйте и запустите её.

    $ comp lb1
    $ ./a.out

Появится окно с сообщением "Hello.".

![Скриншот метки](../image/screenshot_lb1.png){width=6.3cm height=5.325cm}

Между `pr4.c` и `lb1.c` есть лишь несколько изменений.
Программа `diff` полезна для определения различий.

@@@shell
cd misc; diff pr4.c lb1.c
@@@

Это говорит нам:

- Обработчик сигнала `app_activate` не имеет параметра `user_data`.
Если четвертый аргумент `g_signal_connect` равен NULL, вы можете опустить `user_data`.
- Добавлено определение новой переменной `lab`.
- Заголовок окна изменен.
- Создана метка и подключена к окну как дочерний элемент.

Функция `gtk_window_set_child (GTK_WINDOW (win), lab)` делает метку `lab` дочерним виджетом окна `win`.
Будьте осторожны.
Дочерний виджет отличается от дочернего объекта.
Объекты имеют отношения родитель-потомок, и виджеты также имеют отношения родитель-потомок.
Но эти два отношения совершенно разные.
Не путайте их.
В программе `lb1.c`, `lab` является дочерним виджетом `win`.
Дочерние виджеты всегда располагаются внутри своего родительского виджета на экране.
Посмотрите, как появилось окно на экране.
Окно приложения включает метку.

Окно `win` не имеет родителей.
Мы называем такое окно окном верхнего уровня.
Приложение может иметь более одного окна верхнего уровня.

### GtkButton

Следующий виджет — GtkButton.
Он отображает кнопку на экране с меткой или значком на ней.
В этом подразделе мы создадим кнопку с меткой.
Когда кнопка нажимается, она испускает сигнал "clicked".
Следующая программа показывает, как перехватить сигнал и что-то сделать.

@@@include
misc/lb2.c
@@@

Посмотрите на строки с 17 по 19.
Сначала создается экземпляр GtkButton `btn` с меткой "Click me".
Затем кнопка добавляется в окно `win` как дочерний элемент.
Наконец, сигнал "clicked" кнопки подключается к обработчику `click_cb`.
Таким образом, если `btn` нажата, вызывается функция `click_cb`.
Суффикс "cb" означает "call back" (обратный вызов).

Назовите программу `lb2.c` и сохраните её.
Теперь скомпилируйте и запустите её.

![Скриншот метки](../image/screenshot_lb2.png){width=11.205cm height=6.945cm}

Появится окно с кнопкой.
Нажмите на кнопку (это большая кнопка, вы можете нажать в любом месте окна), и строка "Clicked." появится в терминале.
Это показывает, что обработчик был вызван нажатием кнопки.

Хорошо, что мы убедились, что сигнал clicked был перехвачен и обработчик был вызван с помощью `g_print`.
Однако использование `g_print` не гармонирует с GTK, которая является библиотекой GUI.
Поэтому мы изменим обработчик.
Следующий код извлечен из `lb3.c`.

@@@include
misc/lb3.c click_cb app_activate
@@@

А разница между `lb2.c` и `lb3.c` следующая.

@@@shell
cd misc; diff lb2.c lb3.c
@@@

Изменения:

- Функция `g_print` в `lb2.c` была удалена и вставлены две строки.
  - `click_cb` имеет второй параметр, который берется из четвертого аргумента `g_signal_connect` в строке 17.
Важно отметить, что типы различны между вторым параметром `click_cb` и четвертым аргументом `g_signal_connect`.
Первый — `GtkWindow *`, а второй — `GtkWidget *`.
Компилятор не жалуется, потому что `g_signal_connect` использует gpointer (общий тип указателя).
В этой программе экземпляр, на который указывает `win`, является объектом GtkApplicationWindow.
Он является потомком класса GtkWindow и GtkWidget, поэтому оба типа `GtkWindow *` и `GtkWidget *` являются правильными типами экземпляра.
  - `gtk_destroy (win)` уничтожает окно верхнего уровня. Затем приложение завершается.
- Метка `btn` изменена с "Click me" на "Close".
- Четвертый аргумент `g_signal_connect` изменен с `NULL` на `win`.

Наиболее важное изменение — это четвертый аргумент `g_signal_connect`.
Этот аргумент описан как "данные для передачи обработчику" в определении [`g_signal_connect`](https://docs.gtk.org/gobject/func.signal_connect.html).

### GtkBox

GtkWindow и GtkApplicationWindow могут иметь только одного потомка.
Если вы хотите добавить два или более виджетов в окно, вам нужен контейнерный виджет.
GtkBox — один из контейнеров.
Он размещает два или более дочерних виджетов в одной строке или столбце.
Следующая процедура показывает способ добавления двух кнопок в окно.

- Создать экземпляр GtkApplicationWindow.
- Создать экземпляр GtkBox и добавить его в GtkApplicationWindow как дочерний элемент.
- Создать экземпляр GtkButton и добавить его в GtkBox.
- Создать еще один экземпляр GtkButton и добавить его в GtkBox.

После этого виджеты соединены, как показано на следующей диаграмме.

![Отношения родитель-потомок](../image/box.png){width=7.725cm height=2.055cm}

Программа `lb4.c` выглядит следующим образом.

@@@include
misc/lb4.c
@@@

Посмотрите на функцию `app_activate`.

После создания экземпляра GtkApplicationWindow создается экземпляр GtkBox.

~~~C
box = gtk_box_new(GTK_ORIENTATION_VERTICAL, 5);
gtk_box_set_homogeneous (GTK_BOX (box), TRUE);
~~~

Первый аргумент размещает дочерние элементы блока вертикально.
Константы ориентации определены так:

- GTK\_ORIENTATION\_VERTICAL: дочерние виджеты размещаются вертикально
- GTK\_ORIENTATION\_HORIZONTAL: дочерние виджеты размещаются горизонтально

Второй аргумент — размер пространства между дочерними элементами.
Единица длины — пиксель.

Следующая функция заполняет блок дочерними элементами, давая им одинаковое пространство.

После этого создаются две кнопки `btn1` и `btn2`, и устанавливаются обработчики сигналов.
Затем эти две кнопки добавляются в блок.

@@@include
misc/lb4.c click1.cb
@@@

Функция `gtk_button_get_label` возвращает текст из метки.
Строка принадлежит кнопке, и вы не можете изменять или освобождать её.
Квалификатор `const` необходим для строки `s`.
Если вы измените строку, ваш компилятор выдаст предупреждение.

Вам всегда нужно быть осторожными с квалификатором const, когда вы смотрите справочник GTK 4 API.

![Скриншот блока](../image/screenshot_lb4.png){width=6.3cm height=5.325cm}

Обработчик, соответствующий `btn1`, переключает свою метку.
Обработчик, соответствующий `btn2`, уничтожает окно верхнего уровня, и приложение завершается.
